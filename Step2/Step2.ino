#include <M5EPD.h>
const uint8_t m_figur[1732] PROGMEM = // 198 272 298 274 398 292
{ 0x3c,0x3c,0x3c,0x3c,0x3c, 0x3c,0x3c,0x3c,0x3c,0x3c, 0x3c,0x3c,0x3c,0x3c,0x3c, 0x1a,0x49,0x19,0x19,0x4b,
  0x18,0x18,0x4d,0x17,0x17, 0x4f,0x16,0x16,0x46,0x85, 0x46,0x15,0x15,0x46,0x87, 0x46,0x14,0x14,0x46,0x89,
  0x46,0x13,0x13,0x46,0x8b, 0x46,0x12,0x13,0x45,0x8d, 0x45,0x12,0x13,0x45,0x8d, 0x45,0x12,0x13,0x44,0x8f,
  0x44,0x12,0x13,0x45,0x8d, 0x45,0x12,0x13,0x45,0x8d, 0x45,0x12,0x13,0x46,0x8b, 0x46,0x12,0x14,0x46,0x89,
  0x46,0x13,0x15,0x46,0x87, 0x46,0x14,0x16,0x46,0x85, 0x46,0x15,0x17,0x46,0x83, 0x46,0x16,0x18,0x4d,0x17,
  0x18,0x4d,0x17,0x17,0x4f, 0x16,0x16,0x51,0x15,0x15, 0x46,0x87,0x46,0x14,0x14, 0x46,0x89,0x46,0x13,0x13,
  0x46,0x8b,0x46,0x12,0x12, 0x46,0x8d,0x46,0x11,0x11, 0x46,0x8f,0x46,0x10,0x10, 0x46,0x91,0x46,0x0f,0x0f,
  0x46,0x93,0x46,0x0e,0x0e, 0x46,0x95,0x46,0x0d,0x0d, 0x46,0x97,0x46,0x0c,0x0c, 0x46,0x99,0x46,0x0b,0x0b,
  0x67,0x0a,0x0a,0x69,0x09, 0x09,0x6b,0x08,0x09,0x6b, 0x08,0x09,0x44,0xa3,0x44, 0x08,0x09,0x44,0xa3,0x44,
  0x08,0x09,0x44,0xa3,0x44, 0x08,0x09,0x6b,0x08,0x09, 0x6b,0x08,0x09,0x6b,0x08, 0x09,0x6b,0x08,
  0x3c,0x3c,0x3c,0x3c,0x3c, 0x3c,0x3c,0x20,0x44,0x18, 0x1f,0x46,0x17,0x1e,0x4a, 0x14,0x1d,0x4c,0x13,0x1a,
  0x50,0x12,0x18,0x53,0x11, 0x17,0x49,0x86,0x46,0x10, 0x16,0x49,0x89,0x46,0x0f, 0x15,0x47,0x8d,0x46,0x0e,
  0x14,0x46,0x8f,0x46,0x0d, 0x13,0x46,0x91,0x46,0x0c, 0x12,0x46,0x93,0x46,0x0b, 0x10,0x47,0x94,0x46,0x0b,
  0x0f,0x47,0x96,0x45,0x0b, 0x0d,0x47,0x86,0x44,0x8e, 0x46,0x0a,0x0b,0x48,0x86, 0x46,0x8e,0x46,0x09,0x0a,
  0x48,0x87,0x46,0x8e,0x46, 0x09,0x09,0x48,0x89,0x44, 0x8f,0x46,0x09,0x08,0x48, 0x94,0x41,0x89,0x45,0x09,
  0x07,0x46,0x96,0x42,0x89, 0x45,0x09,0x06,0x45,0x98, 0x43,0x88,0x45,0x09,0x06, 0x46,0x96,0x45,0x87,0x46,
  0x08,0x06,0x47,0x94,0x46, 0x88,0x45,0x08,0x06,0x47, 0x93,0x47,0x88,0x45,0x08, 0x06,0x46,0x89,0x52,0x88,
  0x45,0x08,0x06,0x45,0x89, 0x52,0x89,0x46,0x07,0x06, 0x46,0x86,0x53,0x8b,0x45, 0x07,0x06,0x47,0x84,0x53,
  0x8c,0x45,0x07,0x07,0x51, 0x04,0x46,0x8e,0x45,0x07, 0x08,0x4f,0x04,0x46,0x8f, 0x45,0x07,0x09,0x4b,0x06,
  0x46,0x90,0x45,0x07,0x0a, 0x48,0x07,0x46,0x91,0x45, 0x07,0x0b,0x46,0x07,0x46, 0x92,0x45,0x07,0x15,0x48,
  0x93,0x45,0x07,0x13,0x48, 0x95,0x45,0x07,0x11,0x48, 0x97,0x45,0x07,0x10,0x47, 0x99,0x45,0x07,0x0f,0x46,
  0x9b,0x45,0x07,0x0e,0x46, 0x9c,0x45,0x07,0x0a,0x6b, 0x07,0x09,0x6d,0x06,0x08, 0x6f,0x05,0x08,0x6f,0x05,
  0x08,0x45,0xa5,0x45,0x05, 0x08,0x45,0xa5,0x45,0x05, 0x08,0x45,0xa5,0x45,0x05, 0x08,0x45,0xa5,0x45,0x05,
  0x08,0x6f,0x05,0x08,0x6f, 0x05,0x08,0x6f,0x05,0x08, 0x6f,0x05,
  0x3c,0x3c,0x3c,0x3c,0x1d, 0x43,0x1c,0x1c,0x45,0x1b, 0x1b,0x47,0x1a,0x1a,0x44, 0x81,0x44,0x19,0x19,0x44,
  0x83,0x44,0x18,0x19,0x44, 0x83,0x44,0x18,0x19,0x45, 0x81,0x45,0x18,0x1a,0x49, 0x19,0x19,0x4b,0x18,0x18,
  0x46,0x81,0x46,0x17,0x17, 0x46,0x83,0x46,0x16,0x16, 0x46,0x85,0x46,0x15,0x15, 0x46,0x87,0x46,0x14,0x14,
  0x46,0x89,0x46,0x13,0x13, 0x46,0x8b,0x45,0x13,0x12, 0x46,0x8b,0x45,0x02,0x41, 0x11,0x11,0x46,0x8b,0x45,
  0x02,0x43,0x10,0x10,0x46, 0x8b,0x45,0x02,0x45,0x0f, 0x10,0x45,0x8b,0x45,0x02, 0x46,0x0f,0x0f,0x45,0x8b,
  0x45,0x02,0x48,0x0e,0x0f, 0x44,0x8b,0x45,0x02,0x45, 0x81,0x43,0x0e,0x0e,0x44, 0x8b,0x45,0x02,0x45,0x82,
  0x44,0x0d,0x0e,0x44,0x8a, 0x45,0x02,0x45,0x83,0x44, 0x0d,0x0e,0x44,0x89,0x45, 0x02,0x45,0x84,0x44,0x0d,
  0x0e,0x44,0x88,0x45,0x02, 0x45,0x85,0x44,0x0d,0x0e, 0x44,0x87,0x45,0x02,0x45, 0x86,0x44,0x0d,0x0e,0x44,
  0x87,0x44,0x02,0x45,0x87, 0x44,0x0d,0x0e,0x44,0x87, 0x44,0x01,0x45,0x88,0x44, 0x0d,0x0e,0x44,0x87,0x49,
  0x89,0x44,0x0d,0x0e,0x44, 0x88,0x47,0x8a,0x44,0x0d, 0x0e,0x44,0x89,0x45,0x8b, 0x44,0x0d,0x0f,0x44,0x89,
  0x43,0x8b,0x44,0x0e,0x0f, 0x45,0x95,0x45,0x0e,0x10, 0x45,0x93,0x45,0x0f,0x10, 0x46,0x91,0x46,0x0f,0x11,
  0x46,0x8f,0x46,0x10,0x12, 0x46,0x8d,0x46,0x11,0x13, 0x46,0x8b,0x46,0x12,0x14, 0x46,0x89,0x46,0x13,0x15,
  0x46,0x87,0x46,0x14,0x16, 0x46,0x85,0x46,0x15,0x17, 0x46,0x83,0x46,0x16,0x0a, 0x69,0x09,0x09,0x6b,0x08,
  0x08,0x6d,0x07,0x08,0x6d, 0x07,0x08,0x44,0xa5,0x44, 0x07,0x08,0x44,0xa5,0x44, 0x07,0x08,0x44,0xa5,0x44,
  0x07,0x08,0x44,0xa5,0x44, 0x07,0x08,0x6d,0x07,0x08, 0x6d,0x07,0x08,0x6d,0x07, 0x08,0x6d,0x07,
  0x3c,0x3c,0x3c,0x3c,0x3c, 0x3c,0x3c,0x3c,0x3c,0x3c, 0x0a,0x4b,0x04,0x4b,0x04, 0x4b,0x09,0x0a,0x4c,0x02,
  0x4d,0x02,0x4c,0x09,0x0a, 0x4c,0x02,0x4d,0x02,0x4c, 0x09,0x0a,0x4c,0x02,0x4d, 0x02,0x4c,0x09,0x0a,0x44,
  0x84,0x44,0x02,0x44,0x85, 0x44,0x02,0x44,0x84,0x44, 0x09,0x0a,0x44,0x84,0x44, 0x02,0x44,0x85,0x44,0x02,
  0x44,0x84,0x44,0x09,0x0a, 0x44,0x84,0x44,0x02,0x44, 0x85,0x44,0x02,0x44,0x84, 0x44,0x09,0x0a,0x44,0x84,
  0x4a,0x85,0x4a,0x84,0x44, 0x09,0x0a,0x44,0x84,0x4a, 0x85,0x4a,0x84,0x44,0x09, 0x0a,0x44,0x84,0x4a,0x85,
  0x4a,0x84,0x44,0x09,0x0a, 0x44,0x84,0x4a,0x85,0x4a, 0x84,0x44,0x09,0x0a,0x44, 0xa1,0x44,0x09,0x0a,0x44,
  0xa1,0x44,0x09,0x0a,0x44, 0xa1,0x44,0x09,0x0a,0x44, 0xa1,0x44,0x09,0x0a,0x45, 0x9f,0x45,0x09,0x0a,0x69,
  0x09,0x0b,0x67,0x0a,0x0c, 0x65,0x0b,0x0d,0x63,0x0c, 0x12,0x44,0x91,0x44,0x11, 0x12,0x44,0x91,0x44,0x11,
  0x12,0x44,0x91,0x44,0x11, 0x12,0x44,0x91,0x44,0x11, 0x12,0x44,0x91,0x44,0x11, 0x12,0x44,0x91,0x44,0x11,
  0x12,0x44,0x91,0x44,0x11, 0x12,0x44,0x91,0x44,0x11, 0x12,0x44,0x91,0x44,0x11, 0x11,0x44,0x93,0x44,0x10,
  0x10,0x44,0x95,0x44,0x0f, 0x0f,0x44,0x97,0x44,0x0e, 0x0e,0x44,0x99,0x44,0x0d, 0x0d,0x44,0x9b,0x44,0x0c,
  0x0c,0x44,0x9d,0x44,0x0b, 0x0b,0x44,0x9f,0x44,0x0a, 0x0a,0x69,0x09,0x09,0x6b, 0x08,0x08,0x6d,0x07,0x08,
  0x6d,0x07,0x08,0x44,0xa5, 0x44,0x07,0x08,0x44,0xa5, 0x44,0x07,0x08,0x44,0xa5, 0x44,0x07,0x08,0x44,0xa5,
  0x44,0x07,0x08,0x6d,0x07, 0x08,0x6d,0x07,0x08,0x6d, 0x07,0x08,0x6d,0x07,
  0x1b,0x46,0x1b,0x1a,0x48, 0x1a,0x19,0x4a,0x19,0x18, 0x4c,0x18,0x17,0x45,0x84, 0x45,0x17,0x16,0x45,0x86,
  0x45,0x16,0x16,0x44,0x88, 0x44,0x16,0x16,0x44,0x88, 0x44,0x16,0x16,0x44,0x88, 0x44,0x16,0x17,0x44,0x86,
  0x44,0x17,0x05,0x46,0x0d, 0x44,0x84,0x44,0x0d,0x46, 0x05,0x04,0x48,0x0d,0x44, 0x83,0x43,0x0d,0x48,0x04,
  0x03,0x4a,0x0d,0x44,0x82, 0x42,0x0d,0x4a,0x03,0x02, 0x4c,0x0c,0x44,0x82,0x42, 0x0c,0x4c,0x02,0x01,0x45,
  0x84,0x45,0x0a,0x44,0x83, 0x43,0x0a,0x45,0x84,0x45, 0x01,0x45,0x86,0x45,0x09, 0x44,0x83,0x43,0x09,0x45,
  0x86,0x45,0x44,0x88,0x44, 0x08,0x44,0x84,0x44,0x08, 0x44,0x88,0x44,0x44,0x88, 0x44,0x08,0x44,0x84,0x44,
  0x08,0x44,0x88,0x44,0x44, 0x88,0x44,0x07,0x44,0x86, 0x44,0x07,0x44,0x88,0x44, 0x44,0x87,0x44,0x08,0x44,
  0x86,0x44,0x08,0x44,0x87, 0x44,0x45,0x85,0x44,0x08, 0x44,0x88,0x44,0x08,0x44, 0x85,0x45,0x01,0x45,0x84,
  0x44,0x08,0x44,0x88,0x44, 0x08,0x44,0x84,0x45,0x01, 0x02,0x45,0x84,0x44,0x06, 0x44,0x8a,0x44,0x06,0x44,
  0x84,0x45,0x02,0x03,0x44, 0x85,0x44,0x05,0x44,0x8a, 0x44,0x05,0x44,0x85,0x44, 0x03,0x04,0x44,0x85,0x44,
  0x03,0x44,0x8c,0x44,0x03, 0x44,0x85,0x44,0x04,0x04, 0x44,0x86,0x44,0x02,0x44, 0x8c,0x44,0x02,0x44,0x86,
  0x44,0x04,0x05,0x43,0x87, 0x48,0x8e,0x48,0x87,0x43, 0x05,0x05,0x44,0x87,0x47, 0x8e,0x47,0x87,0x44,0x05,
  0x05,0x44,0x88,0x45,0x90, 0x45,0x88,0x44,0x05,0x06, 0x43,0x89,0x43,0x92,0x43, 0x89,0x43,0x06,0x06,0x44,
  0xa8,0x44,0x06,0x06,0x44, 0xa8,0x44,0x06,0x07,0x43, 0xa8,0x43,0x07,0x07,0x44, 0xa6,0x44,0x07,0x07,0x44,
  0xa6,0x44,0x07,0x08,0x43, 0xa6,0x43,0x08,0x08,0x44, 0x88,0x54,0x88,0x44,0x08, 0x08,0x44,0x87,0x56,0x87,
  0x44,0x08,0x09,0x43,0x85, 0x5a,0x85,0x43,0x09,0x09, 0x44,0x83,0x5c,0x83,0x44, 0x09,0x09,0x4b,0x94,0x4b,
  0x09,0x0a,0x49,0x96,0x49, 0x0a,0x0a,0x48,0x98,0x48, 0x0a,0x0a,0x47,0x9a,0x47, 0x0a,0x0a,0x44,0xa0,0x44,
  0x0a,0x0a,0x44,0xa0,0x44, 0x0a,0x0a,0x44,0x84,0x58, 0x84,0x44,0x0a,0x0b,0x44, 0x82,0x5a,0x82,0x44,0x0b,
  0x0c,0x64,0x0c,0x0c,0x64, 0x0c,0x0c,0x48,0x94,0x48, 0x0c,0x0c,0x47,0x96,0x47, 0x0c,0x0c,0x44,0x9c,0x44,
  0x0c,0x0c,0x44,0x9c,0x44, 0x0c,0x0c,0x64,0x0c,0x0c, 0x64,0x0c,0x0d,0x62,0x0d, 0x0e,0x60,0x0e, 
  0x3c,0x3c,0x1c,0x44,0x1c, 0x1b,0x46,0x1b,0x1a,0x48, 0x1a,0x1a,0x48,0x1a,0x09, 0x48,0x09,0x48,0x09,0x48,
  0x09,0x08,0x4a,0x07,0x4a, 0x07,0x4a,0x08,0x07,0x54, 0x06,0x54,0x07,0x06,0x54, 0x08,0x54,0x06,0x05,0x45,
  0x86,0x4a,0x88,0x4a,0x86, 0x45,0x05,0x04,0x45,0x8a, 0x48,0x86,0x48,0x8a,0x45, 0x04,0x03,0x45,0x8e,0x50,
  0x8e,0x45,0x03,0x02,0x45, 0x90,0x4e,0x90,0x45,0x02, 0x01,0x45,0x92,0x4c,0x92, 0x45,0x01,0x45,0x94,0x4a,
  0x94,0x45,0x44,0x96,0x48, 0x96,0x44,0x44,0x96,0x48, 0x96,0x44,0x44,0x96,0x48, 0x96,0x44,0x44,0x97,0x46,
  0x97,0x44,0x44,0x98,0x44, 0x98,0x44,0x44,0x98,0x44, 0x98,0x44,0x44,0x98,0x44, 0x98,0x44,0x44,0x98,0x44,
  0x98,0x44,0x44,0x98,0x44, 0x98,0x44,0x44,0x98,0x44, 0x98,0x44,0x44,0x98,0x44, 0x98,0x44,0x45,0x97,0x44,
  0x97,0x45,0x46,0x95,0x46, 0x95,0x46,0x01,0x46,0x93, 0x48,0x93,0x46,0x01,0x02, 0x46,0x92,0x48,0x92,0x46,
  0x02,0x03,0x46,0x91,0x48, 0x91,0x46,0x03,0x04,0x46, 0x8f,0x4a,0x8f,0x46,0x04, 0x05,0x46,0x8d,0x4c,0x8d,
  0x46,0x05,0x06,0x46,0x8a, 0x50,0x8a,0x46,0x06,0x07, 0x46,0x87,0x54,0x87,0x46, 0x07,0x08,0x6c,0x08,0x09,
  0x6a,0x09,0x0a,0x68,0x0a, 0x0a,0x4b,0x92,0x4b,0x0a, 0x0a,0x4a,0x94,0x4a,0x0a, 0x0a,0x49,0x96,0x49,0x0a,
  0x0a,0x48,0x98,0x48,0x0a, 0x0a,0x47,0x9a,0x47,0x0a, 0x0a,0x44,0xa0,0x44,0x0a, 0x0a,0x44,0xa0,0x44,0x0a,
  0x0a,0x44,0x84,0x58,0x84, 0x44,0x0a,0x0a,0x44,0x83, 0x5a,0x83,0x44,0x0a,0x0a, 0x68,0x0a,0x0a,0x68,0x0a,
  0x0a,0x4a,0x94,0x4a,0x0a, 0x0a,0x49,0x96,0x49,0x0a, 0x0b,0x45,0x9c,0x45,0x0b, 0x0c,0x44,0x9c,0x44,0x0c,
  0x0c,0x64,0x0c,0x0c,0x64, 0x0c,0x0d,0x62,0x0d,0x0e, 0x60,0x0e,
};
const uint16_t m_fig_u[6] PROGMEM = { 0,198,470,768,1042,1440 };
             
uint8_t not_x = 1, not_y = 1, rb = 0, cod_col = 0, cod_cnt = 0 ;
uint8_t col_fig = 7, col_fon = 1 ;
int smesh_d = 150, uk_mas = 0, uk_i = 0, uk_j = 0, uk_cnt = 0 ;  

M5EPD_Canvas canvas(&M5.EPD);
M5EPD_Canvas canvas1(&M5.EPD);

void Out_Figur(uint8_t kod_fig){
 if ((kod_fig&8)==8) {
  col_fig = 0;} else {
  col_fig = 7;}
 if((not_x + not_y)&1==1){
  col_fon = 1;} else {
  col_fon = 0;}
 if (kod_fig==0) {
  uk_mas = 0;
 } else {
  uk_mas = m_fig_u[(kod_fig&7)-1];
 }
 for (uk_j = 0; uk_j < 58; uk_j++){
  uk_i = 0;
  while ( uk_i < 60){
   rb = m_figur[uk_mas]; uk_mas++;
   cod_col = (rb&0xc0) >> 6; cod_cnt = (rb & 0x3f);
   for (uk_cnt = 0; uk_cnt < cod_cnt; uk_cnt++){
    if (cod_col == 0) { canvas1.drawPixel(uk_i, uk_j, col_fon); uk_i++; };
    if (cod_col == 1) { canvas1.drawPixel(uk_i, uk_j, 15 ); uk_i++; };
    if (cod_col == 2) { canvas1.drawPixel(uk_i, uk_j, col_fig); uk_i++; }
   }
  }
 }
}

void setup(){
 M5.begin();
 M5.update();
 M5.EPD.SetRotation(90);
 M5.EPD.Clear(true);
 canvas.createCanvas(540, 960);
 canvas.fillCanvas(0);
 canvas.pushCanvas(0,0,UPDATE_MODE_GC16);
 canvas1.createCanvas(60, 58);
 canvas1.fillCanvas(0);
 for (int8_t i = 0; i < 6; i++){
  int8_t fig_o = i+1;       // black pieces 1..6
  Out_Figur(fig_o);
  canvas1.pushCanvas((1+i)*67+6, 159+4*67,UPDATE_MODE_GC16);
  fig_o=fig_o+8;            // white pieces 1..6  
  Out_Figur(fig_o);
  canvas1.pushCanvas((1+i)*67+6, 159+3*67,UPDATE_MODE_GC16);
 }
} 
void loop(){
}
